## 音视频基本原理

- [音视频基本原理](#音视频基本原理)
  - [视频录制原理](#视频录制原理)
  - [音视频播放原理](#音视频播放原理)
  - [视频主要概念](#视频主要概念)
  - [音频主要概念](#音频主要概念)
  - [封装概念](#封装概念)
  - [音视频同步](#音视频同步)

### 视频录制原理

![音视频录制原理](https://github.com/gongluck/images/blob/main/音视频录制原理.png)

### 音视频播放原理

![音视频播放原理](https://github.com/gongluck/images/blob/main/音视频播放原理.png)

### 视频主要概念

- **视频码率**：**kb/s**，是指视频文件在单位时间内使用的数据流量，也叫码流率。码率越大，说明单位时间内取样率越大，数据流精度就越高。
- **视频帧率**：**fps**，通常说一个视频的25帧，指的就是这个视频帧率，即1秒中会显示25帧。帧率越高，给人的视觉就越流畅。
- **视频分辨率**：分辨率就是我们常说的640x480分辨率、1920x1080分辨率，分辨率影响视频图像的大小。
- **I**帧（**Intra coded frames**）：
  - I帧不需要参考其他画面而生成，解码时仅靠自己就重构完整图像；

  - I帧图像采用帧内编码方式；
    
  - I帧所占数据的信息量比较大；
    
  - I帧图像是周期性出现在图像序列中的，出现频率可由编码器选择；
    
  - I帧是P帧和B帧的参考帧（其质量直接影响到同组中以后各帧的质量）；
    
  - **IDR**帧是帧组GOP的基础帧（第一个（I）帧），在一组GOP中只有一个IDR帧；
    
  - I帧不需要考虑运动矢量；
- **P**帧（**Predicted frames**）根据本帧与相邻的前一帧（I帧或P帧）的不同点来压缩本帧数据，同时利用了空间和时间上的相关性。
- P帧属于前向预测的帧间编码。它需要参考前面最靠近它的**I**帧或**P**帧来解码。
- **B**帧（**Bi-directional predicted frames**）采用双向时间预测，可以大大提高压缩倍数。

### 音频主要概念

- **采样频率**：每秒钟采样的点的个数。常用的采样频率有：

    |      采样率      |   常见用途    |
    | :--------------: | :-----------: |
    |  22000（22kHz）  |   无线广播    |
    | 44100（44.1kHz） |    CD音质     |
    |  48000（48kHz）  | 数字电视，DVD |
    |  96000（96kHz）  | 蓝光，高清DVD |
    | 192000（192kHz） | 蓝光，高清DVD |

- **采样精度（采样深度）**：每个“样本点”的大小，常用的大小为8bit， 16bit，24bit。

- **通道数**：单声道，双声道，四声道，5.1声道。

- **比特率**：每秒传输的bit数，单位为：bps（Bit Per Second）。间接衡量声音质量的一个标准。没有压缩的音频数据的比特率 = 采样频率 * 采样精度 * 通道数。

- **码率**：压缩后的音频数据的比特率。常见的码率：

    |    码率     |   常见用途   |
    | :---------: | :----------: |
    |   96kbps    |    FM质量    |
    | 128-160kbps | 一般质量音频 |
    |   192kbps   |    CD质量    |
    | 256-320Kbps |  高质量音频  |

    - 码率越大，压缩效率越低，音质越好，压缩后数据越大。

    - 码率 = 音频文件大小 / 时长。

- **帧**：每次编码的采样单元数，比如MP3通常是1152个采样点作为一个编码单元，AAC通常是1024个采样点作为一个编码单元。

- **帧长**：可以指每帧播放持续的时间。每帧持续时间（秒）= 每帧采样点数 / 采样频率（HZ）。比如：MP3 48k，1152个采样点，每帧则为24毫秒，1152/48000 = 0.024秒 = 24毫秒；也可以指压缩后每帧的数据长度。

- **交错模式**：数字音频信号存储的方式。数据以连续帧的方式存放，即首先记录帧1的左声道样本和右声道样本，再开始帧2的记录...

- **非交错模式**：首先记录的是一个周期内所有帧的左声道样本，再记录所有右声道样本。

- 数字音频压缩编码在保证信号在听觉方面不产生失真的前提下，对音频数据信号进行尽可能大的压缩，降低数据量。数字音频压缩编码采取去除声音信号中冗余成分的方法来实现。所谓冗余成分指的是音频中不能被人耳感知到的信号，它们对确定声音的音色，音调等信息没有任何的帮助。

### 封装概念

- **封装格式**（也叫容器）就是将已经编码压缩好的视频流、音频流及字幕按照一定的方案放到一个文件中，便于播放软件播放。

- **一般来说，视频文件的后缀名就是它的封装格式。**

- **封装的格式不一样，后缀名也就不一样。**

### 音视频同步

- **DTS**（**Decoding Time Stamp**）：即解码时间戳，这个时间戳的意义在于告诉播放器该在什么时候解码这一帧的数据。

- **PTS**（**Presentation Time Stamp**）：即显示时间戳，这个时间戳用来告诉播放器该在什么时候显示这一帧的数据。

- **音视频同步方式：**

    |         名称          |           实现           |
    | :-------------------: | :----------------------: |
    |     Audio Master      |      同步视频到音频      |
    |     Video Master      |      同步音频到视频      |
    | External Clock Master | 同步音频和视频到外部时钟 |

    - 一般情况下选择：Audio Master > External Clock Master > Video Master
